# Спецификация требований к программному обеспечению
## Для 2023-etu-practice-world-bank-open-data-analytics-gdp
Версия 1.0.
Подготовлено Швец С.
09.04.2023


* [Вступление](#1-вступление)
  * 1.1 [Цели](#11-Цели)
  * 1.2 [Соглашения о терминах](#12-Соглашения-о-терминах)
  * 1.3 [Предполагаемая аудитория и рекомендации по чтению](#13-Предполагаемая-аудитория-и-рекомендации-по-чтению)
  * 1.4 [Масштаб проекта](#14-Масштаб-проекта)
  * 1.5 [Ссылки на источники](#15-Ссылки-на-источники)
* [Общее описание](#2-Общее-описание)
  * 2.1 [Перспектива продукта](#21-Перспектива-продукта)
  * 2.2 [Пользовательские классы и характеристики](#22-Функциональность-продукта)
  * 2.3 [Пользовательские классы и характеристики](#23-Пользовательские-классы-и-характеристики)
  * 2.4 [Операционная среда](#24-Операционная-среда)
  * 2.5 [Рамки, ограничения, правила и стандарты](#25-Рамки-ограничения-правила-и-стандарты)
  * 2.6 [Пользовательская документация](#26-Пользовательская-документация)
  * 2.7 [Допущения и зависимости](#27-Допущения-и-зависимости)
* [Функциональность системы](#3-Функциональность-системы)
  * 3.1 [Регистрация пользователя](#31-Регистрация-пользователя)
  * 3.2 [Аутентификация пользователя](#32-Аутентификация-пользователя)
  * 3.3 [Обновление токенов](#33-Обновление-токенов)
  * 3.4 [Выход пользователя из системы](#34-Выход-пользователя-из-системы)
  * 3.5 [Получение данных](#35-Получение-данных)
* [Требования к внешним интерфейсам](#4-Требования-к-внешним-интерфейсам)
  * 4.1 [Интерфейсы пользователя (UX)](#41-Интерфейсы-пользователя-UX)
  * 4.2 [Программные интерфейсы](#42-Программные-интерфейсы)
  * 4.3 [Интерфейсы оборудования](#43-Интерфейсы-оборудования)
  * 4.4 [Интерфейсы связи и коммуникации](#44-Интерфейсы-связи-и-коммуникации)
* [Нефункциональные требования](#5-Нефункциональные-требования)
  * 5.1 [Требования-к-производительности](#51-Требования-к-производительности)
  * 5.2 [Требования к сохранности (данных)](#52-Требования-к-сохранности-данных)
  * 5.3 [Требования к качеству программного обеспечения](#53-Требования-к-качеству-программного-обеспечения)
  * 5.4 [Требования к безопасности системы](#54-Требования-к-безопасности-системы)
  * 5.5 [Требования на интеллектуальную собственность](#55-Требования-на-интеллектуальную-собственность)
* [Прочее](#Прочее)
  * [Приложение А: Глоссарий](#Приложение-А-Глоссарий)
  * [Приложение Б: Модели процессов и предметной области и другие диаграммы](#Приложение-Б-Модели-процессов-и-предметной-области-и-другие-диаграммы)
  * [Приложение В: Список ключевых задач](#Приложение-В-Список-ключевых-задач)

## 1. Вступление
### 1.1 Цели
### 1.2 Соглашения о терминах
### 1.3 Предполагаемая аудитория и рекомендации по чтению
### 1.4 Масштаб проекта
### 1.5 Ссылки на источники
## 2. Общее описание
### 2.1 Перспектива продукта
### 2.2 Функциональность продукта
### 2.3 Пользовательские классы и характеристики
### 2.4 Операционная среда
### 2.5 Рамки, ограничения, правила и стандарты
### 2.6 Пользовательская документация
### 2.7 Допущения и зависимости
## 3. Функциональность системы
### 3.1 Регистрация пользователя
Новому пользователю необходимо отправить POST-запрос на `api/v1/auth/registration`
в формате JSON со следующим телом:

    {
        "email":"example@mail.com",
        "password":"example",
        "firstname": "example",
        "lastname": "example"
    }

Значения ключа `"email"` должно быть уникально. Иначе приложение пришлет сообщение об ошибке со статусом 401 Unauthorized:

    {
        "timestamp": "2023-04-24T11:37:43.6973147",
        "message": "User with email example@mail.com already exists"
    }

Также ошибка и стасус 401 придет, если при регистрации были неверно заполнены некоторые поля или если они указаны не все:

    {
        "timestamp": "2023-04-24T11:38:42.5249648",
        "message": "Some fields are null or incorrect"
    }

В случае, если регистрация прошла успешно, пользовотелю придет ответ с *Access-* и *Refresh-* токенами:

    {
        "email": "example@mail.com",
        "access_token": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJleGFtcGxlQG1haWwuY29tIiwiaWF0IjoxNjgyMzI1NDI0LCJleHAiOjE2ODIzMjYzMjR9.U-M23c4kKS3AILK-2k3d80RhVkPPjj9jDE2a0MdO5Jw",
        "refresh_token": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJleGFtcGxlQG1haWwuY29tIiwiaWF0IjoxNjgyMzI1NDI0LCJleHAiOjE2ODM1MzUwMjR9.GdY7v2i8gDeTIbMl-DiryviZ5-iwCtPYHoQdugHJU7o"
    }

### 3.2 Аутентификация пользователя
Чтобы пройти аутентификацию, необходимо отправить POST-запрос на `api/v1/auth/login`,
содеражащим логин и пароль пользователя в теле:

    {
        "email":"example@mail.com",
        "password":"example"
    }

Если при аутентификации были неверно заполнены некоторые поля или если они указаны не все,
приложение отправит сообщение об ошибке:

    {
        "timestamp": "2023-04-24T11:56:47.4257805",
        "message": "Some fields are null or incorrect"
    }

При успешной аутентификации пользовотелю придет ответ с *Access-* и *Refresh-* токенами:

    {
        "email": "example@mail.com",
        "access_token": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJleGFtcGxlQG1haWwuY29tIiwiaWF0IjoxNjgyMzI1NDI0LCJleHAiOjE2ODIzMjYzMjR9.U-M23c4kKS3AILK-2k3d80RhVkPPjj9jDE2a0MdO5Jw",
        "refresh_token": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJleGFtcGxlQG1haWwuY29tIiwiaWF0IjoxNjgyMzI1NDI0LCJleHAiOjE2ODM1MzUwMjR9.GdY7v2i8gDeTIbMl-DiryviZ5-iwCtPYHoQdugHJU7o"
    }

При дальнейшем обращении к серверу пользователь использует *Access-* токен, указывая его в заголовке HTTP-запроса `Authorization`.
Заголовок имеет следующий вид: `Bearer <access-token>`.
Если *Access-* токен невалидный или истек срок его жизни, пользователь получает ошибку:

    {
        "timestamp": "2023-04-24T12:19:16.9999498",
        "message": "JWT token is expired or invalid"
    }

### 3.3 Обновление токенов
Время жизни *Access-* токена - 15 минут. После этого он становится недействительным и его необходимо обновить.
Пользоваетль отправляет GET-запрос на `api/v1/auth/refresh`,
передавая *Refresh-* токен в заголовке запроса `Authorization`: `Bearer <refresh-token>`.

При успешном обновлении приложение отправит сообщение с новыми *Access-* и *Refresh-* токенами:

    {
        "email": "example@mail.com",
        "access_token": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJleGFtcGxlQG1haWwuY29tIiwiaWF0IjoxNjgyMzI4NDU2LCJleHAiOjE2ODIzMjkzNTZ9.V3Hc7fjJyuoTuCynXi1pcxZYhRP04YMRyBJrPVJAOww",
        "refresh_token": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJleGFtcGxlQG1haWwuY29tIiwiaWF0IjoxNjgyMzI4NDU2LCJleHAiOjE2ODM1MzgwNTZ9.pIKZDG2GYVqh_Coz5u9dw0cEpUNm44zhmaInu2pGLmA"
    }

При этом раннее использованный *Refresh-* токен становится теперь недействительным.

Если *Refresh-* токен невалидный или истек срок его жизни, пользователь получает ошибку:

    {
        "timestamp": "2023-04-24T12:29:58.4769615",
        "message": "JWT token is expired or invalid"
    }

В случае, если у *Refresh-* токена истек срок его жизни, пользователю необходимо заново [пройти
процедуру аутентификации](#32-Аутентификация-пользователя).

### 3.4 Выход пользователя из системы
Для выхода из системы пользователю необходимо отправить POST-запрос на `api/v1/auth/logout`.
В заголовке запроса `Authorization` необходимо передать *Refresh-* токен: `Bearer <refresh-token>`.
Использованный *Refresh-* токен станет недействительным.

Чтобы выйти со всех устройств, необходимо добавить соотвествующий параметр. Адрес POST-запроса будет выглядеть так:
`api/v1/auth/logout?fromAllDevices=true`. Все *Refresh-* токены
для этого пользователя становятся недействительными.

### 3.5 Получение данных
Чтобы получить данные о ВВП, росте инфляции, импорте и экспорте, пользователю необходимо отправить GET-запрос на `api/v1/{gdp, inflation, exports, imports}`.

Пользователь может воспользоваться следующими опциаональными парметрами запроса:

+ *country_code* — данные фильтруются по стране или по списку стран `api/v1/gdp?country_code=rus`, `api/v1/gdp?country_code=usa,fra`;
+ *start_date* и *end_date*, по значению которых данные фильтруются по заданному диапазону дат `/api/v1/gdp?start_date=2018&end_date=2020`;
+ *start_value* и *end_value*, по значению которых данные фильтруются по заданному значению показателей `api/v1/gdp?start_value=1000000000000&end_value=5000000000000`;
+ *sort*, который обеспечивает сортировку по заданным полям, а также задает ее порядок `api/v1/gdp?sort=-value,%2Byear`. Сортировка доступна по следующим полям: `year`, `country`, `country_code`, `value`.
+ *page* и *per_page*, которые обеспечивает пагинацию `api/v1/gdp?page=0,per_page=20` или `api/v1/gdp?page=0`. По умолчанию параметр per_page равен 50. Пагинация происходит, если указан параметр page.

## 4. Требования к внешним интерфейсам
### 4.1 Интерфейсы пользователя (UX)
Аутентификация в системе реализована на основе **JSON Web Token (JWT)**.
Токены создаются сервером, подписываются секретным ключом и передаются клиенту, который в дальнейшем использует данный
токен для подтверждения подлинности аккаунта.

+ *Access-токен* — это токен, который предоставляет доступ его владельцу к защищённым ресурсам сервера. Имеет короткий
  срок жизни (15 минут) и несет в себе дополнительную информацию стороны, запрашивающей данный токен.
+ *Refresh-токен* — это токен, позволяющий клиентам запрашивать новые access-токены по истечении их времени жизни.
  Данные токены выдаются на длительный срок (14 суток).

Реализована следующая схема работы:

1. Клиент проходит аутентификацию в приложении с использованием логина и пароля.
2. В случае успешной аутентификации сервер отправляет клиенту access- и refresh-токены.
3. При дальнейшем обращении к серверу клиент использует access-токен.
   Сервер проверяет токен на валидность и предоставляет клиенту доступ к ресурсам.
4. В случае, если access-токен становится невалидным, клиент отправляет refresh-токен,
   в ответ на который сервер предоставляет два обновлённых токена.
5. В случае, если refresh-токен становится невалидным, клиент опять должен пройти процесс аутентификации.
### 4.2 Программные интерфейсы
### 4.3 Интерфейсы оборудования
### 4.4 Интерфейсы связи и коммуникации
## 5. Нефункциональные требования
### 5.1 Требования к производительности
### 5.2 Требования к сохранности (данных)
### 5.3 Требования к качеству программного обеспечения
### 5.4 Требования к безопасности системы
### 5.5 Требования на интеллектуальную собственность
## Прочее
### Приложение А: Глоссарий
### Приложение Б: Модели процессов и предметной области и другие диаграммы
### Приложение В: Список ключевых задач